# ç‚¹å‡»æ²¡æ•ˆæœï¼Œæ€»æ„Ÿè§‰å°‘ç‚¹å•¥

ç”¨antdè‡ªå¸¦èœå•å¯¼èˆªï¼Œç‚¹å‡»èœå•é¡¹çš„æ—¶å€™å¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«coolçš„æ•ˆæœï¼Œé‚£æˆ‘ä»¬å°±è‡ªå·±åŠ¨æ‰‹åŠ ä¸Šå§ã€‚
 
## å€Ÿé‰´äº†ç½‘ä¸Šä¸€å¤§ä½¬çš„å®ç°ï¼Œå¹¶åœ¨å…¶åŸºç¡€ä¸Šè¡¥å…¨å®Œå–„

[å¤§ä½¬çš„å®ç°](https://zhuanlan.zhihu.com/p/99835473)

**åœ¨å…¶åŸºç¡€ä¸Šæˆ‘è¡¥å…¨äº†åŠŸèƒ½ï¼Œä½¿å…¶èƒ½å¤Ÿè§£å†³æˆ‘æ‰€é‡åˆ°çš„é—®é¢˜ï¼š**

é¦–å…ˆèœå•é¡¹æ˜¯å¤šé¡¹å¹¶ä¸”å•é¡¹ç‚¹å‡»åˆ‡æ¢çš„ï¼Œå¤§ä½¬çš„å®ç°å¹¶ä¸èƒ½å¾ˆå¥½å®Œæˆè¿™ä¸€ç‚¹ï¼Œå½“å­˜åœ¨å¤šä¸ªå…·å¤‡è¯¥ç‰¹æ•ˆçš„èŠ‚ç‚¹æ—¶ï¼Œä¸€æ—¦åˆ·æ–°ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹éƒ½ä¼šè§¦å‘åˆ·æ–°ï¼Œé‚£å°±æ˜¯æ»¡å±çš„æ³¢çº¹ï¼Œè¿™ä¸€ç‚¹å¿…é¡»è§£å†³ã€‚

---

# å¼€å§‹é‡æ„ä»¥è¾¾åˆ°æœŸæœ›

é¦–å…ˆåšæˆä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨taæ¥å¯¹å…¶ä»–ç»„ä»¶è¿›è¡ŒåŒ…è£…ï¼Œä½¿å…¶å…·æœ‰ç‚¹å‡»ç‰¹æ•ˆï¼Œæ–¹ä¾¿ä½¿ç”¨ã€‚

ç»„ä»¶å‘½åä¸º`withMaterialHoc`ï¼Œå…ˆè´´å‡ºç»„ä»¶çš„å®ç°ï¼š


`withMaterialHoc/index.js`
```js
import React from 'react';
import { Ripple, calcEventRelativePos } from './ripple';

let withMaterialHoc = (WrappedComponent) => {
  return class WithMaterial extends React.Component {
    constructor(props) {
      super(props)
      this.isSwitchIntl = false;
      this.state = {
        spawnData: "",
        clickCount: 0,
        isSwitchIntl: false
      }
    }

    handleClick = (event) => {
      this.setState({
        spawnData: calcEventRelativePos(event),
        time: Date.now(),
        clickCount: this.state.clickCount + 1
      });
    }

    shouldComponentUpdate(nextProps, nextState) {
      if (nextProps.intlData != this.props.intlData) {
        return true;
      }
      if (nextState.clickCount && (nextState.clickCount - this.state.clickCount === 1)) {
        return true
      } else {
        return false
      }
    }

    handleRippleEnd = () => {
      let value = this.state.clickCount - 1
      if (value < 0) {
        value = 0
      }
      this.setState({
        clickCount: value
      })
    }

    render() {
      const { spawnData } = this.state;
      const { className, style } = this.props;
      return (
        <div
          className={`g-btn ${className || ' '}`}
          onClick={this.handleClick}
          style={style}
        >
          <WrappedComponent {...this.props} />
          <Ripple handleRippleEnd={this.handleRippleEnd} spawnData={spawnData} />
        </div>
      );
    }
  };
}

export default withMaterialHoc;
```
`ripple.js`ï¼š
```js
import React, { useState, useEffect, useRef, Fragment,memo } from 'react';
import './index.css';
import { useSpring, animated } from 'react-spring';

function calcEventRelativePos(event) {
  const rect = event.target.getBoundingClientRect();
  return {
    x: event.clientX - rect.left,
    y: event.clientY - rect.top,
  };
}
function Ripple(props) {
  const [data, setData] = useState({ top: 0, left: 0, width: 0, height: 0 });
  const isInit = useRef(true);
  const rippleEl = useRef(null);
  const { spawnData, handleRippleEnd} = props;
  const rippleAnim = useSpring({
    from: {
      ...props.style,
      ...data,
      transform: 'scale(0)',
      opacity: 1,
    },
    to: !isInit.current ? { opacity: 0, transform: 'scale(2)' } : {},
    config: {
      duration: props.duration || 300,
    },
    onRest: () => {
      handleRippleEnd()
    },
    reset: true
  });

  useEffect(() => {
    if (isInit.current) {
      isInit.current = false;
    } else {
      const parentEl = rippleEl.current.parentElement;
      const size = Math.max(parentEl.offsetWidth, parentEl.offsetHeight);
      setData({
        width: size,
        height: size,
        top: spawnData.y - size / 2 || 0,
        left: spawnData.x - size / 2+50 || 50
      });
    }
  }, [spawnData]);
  return (
    <animated.span
          className="g-ripple"
          style={rippleAnim}
          ref={rippleEl}
        ></animated.span>
  );
}

Ripple = memo(Ripple)

export { Ripple, calcEventRelativePos };

```
## åˆ†æï¼š

### å¤§ä½¬çš„å®ç°ä¸ºä»€ä¹ˆä¸è¡Œï¼Ÿ

å› ä¸º`ripple`æ˜¯ä¸€ä¸ªå‡½æ•°ç»„ä»¶ï¼Œæ¯æ¬¡çˆ¶ç»„ä»¶åˆ·æ–°ï¼Œå­ç»„ä»¶å°±ä¼šåˆ·æ–°ï¼Œä»è€Œå‡ºå‘äº†åŠ¨ç”»ï¼ˆå®ç°ç”¨çš„æ˜¯`react-spring`åº“ï¼Œæœ‰å…´è¶£å¯ä»¥æ·±å…¥äº†è§£ï¼‰ã€‚

é‚£ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜çš„å…³é”®å°±æ˜¯ï¼Œ**æˆ‘ç‚¹å‡»å“ªä¸ªèŠ‚ç‚¹ï¼Œå“ªä¸ªèŠ‚ç‚¹è§¦å‘åˆ·æ–°ï¼Œå…¶ä»–çš„èŠ‚ç‚¹ä¸åˆ·æ–°**ã€‚

## ä½¿ç”¨memoæ¥æ§åˆ¶å‡½æ•°ç»„ä»¶çš„åˆ·æ–°

### React.memo

>React.memo ä¸ºé«˜é˜¶ç»„ä»¶ã€‚å®ƒä¸ React.PureComponent éå¸¸ç›¸ä¼¼ï¼Œä½†å®ƒé€‚ç”¨äºå‡½æ•°ç»„ä»¶ï¼Œä½†ä¸é€‚ç”¨äº class ç»„ä»¶ã€‚


é¦–å…ˆå¦‚æœçˆ¶ç»„ä»¶ä¼ å…¥å­ç»„ä»¶çš„`props`ä¸æ”¹å˜æˆ–è€…æ˜¯å¼•ç”¨çš„åœ°å€ä¸å˜ï¼ˆæµ…æ¯”è¾ƒï¼‰ï¼Œé‚£ä¹ˆè¢«`memo`åŒ…è£…è¿‡çš„å‡½æ•°ç»„ä»¶å°±ä¸ä¼šè§¦å‘åˆ·æ–°ï¼Œsoï¼Œé—®é¢˜å°±çœŸä¹ˆæ„‰å¿«çš„è§£å†³äº†ã€‚

# çœ‹ä¸‹æ•ˆæœå§
![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/81e909ff27454cd689d2cccba42c38f2~tplv-k3u1fbpfcp-zoom-1.image)

# ç»“è¯­

æ•ˆæœå°±æ˜¯å®ç¼ºæ¯‹æ»¥çš„ï¼Œæœ‰æ—¶æ°åˆ°å¥½å¤„çš„ç‚¹ç¼€ï¼Œä¼šèµ·åˆ°æ„æƒ³ä¸åˆ°çš„æ•ˆæœï¼Œå†…å¤–å…¼ä¿®ï¼Œæ‰æ˜¯æœ€ä½³çš„å®ç°ï¼Œèµ¶ç´§åŠ ä¸Šè¯•è¯•ã€‚

[é›†æˆäº†è¯¥åŠŸèƒ½çš„ğŸŒ°](https://github.com/moderateReact/moderate-react-template)