# ä»€ä¹ˆæ˜¯`JSON Schema`

æ€ä¹ˆå®šä¹‰å‘¢ï¼Œè¯´å¥å®è¯æˆ‘æ˜¯å†™å®Œäº†æ‰å‘ç°ï¼Œè¿™ä¸è·Ÿä¼ è¯´çš„`JSON Schema`å·®ä¸å¤šä¹ˆï¼Œsoï¼Œæˆ‘å°±è¯´taæ˜¯`JSON Schema`ï¼ˆæˆ‘ç†è§£çš„ï¼Œæ­£ä¸æ­£ç»ä¸çŸ¥é“ï¼‰ã€‚

## æ­£ç»çš„å®šä¹‰

>Json Schemaå®šä¹‰äº†ä¸€å¥—è¯æ±‡å’Œè§„åˆ™ï¼Œè¿™å¥—è¯æ±‡å’Œè§„åˆ™ç”¨æ¥å®šä¹‰Jsonå…ƒæ•°æ®ï¼Œä¸”å…ƒæ•°æ®ä¹Ÿæ˜¯é€šè¿‡Jsonæ•°æ®å½¢å¼è¡¨è¾¾çš„ã€‚Jsonå…ƒæ•°æ®å®šä¹‰äº†Jsonæ•°æ®éœ€è¦æ»¡è¶³çš„è§„èŒƒï¼Œè§„èŒƒåŒ…æ‹¬æˆå‘˜ã€ç»“æ„ã€ç±»å‹ã€çº¦æŸç­‰ã€‚

## æˆ‘å› ä¸ºå•¥å†™

ä¸€ç›´ä»¥æ¥å’Œåå°è¿›è¡Œè”è°ƒè¿™ä»¶äº‹éƒ½æ˜¯ä¸€ä»¶å¾ˆ"**å›°æ‰°**"çš„äº‹æƒ…ï¼Œä¸»è¦æ˜¯**æ²Ÿé€šæˆæœ¬å¤ªå¤§**ï¼Œå…¶ä¸»è¦é›†ä¸­åœ¨æ¥å£æ–‡æ¡£çš„æ²Ÿé€šä¸Šï¼Œä¸æ˜¯è¿™ä¸ªå‚æ•°å€¼ä¸ç”¨ä¼ ï¼Œå°±æ˜¯é‚£ä¸ªå€¼å¿…é¡»å†™çš„ï¼Œæˆ–è€…æŸäº›å‚æ•°å¿…é¡»æ˜¯ä»€ä¹ˆç±»å‹çš„ã€‚è¿˜éƒ½ä¸è½å®åˆ°æ–‡æ¡£ï¼Œè¿™ä¹ˆè¯´ä¹Ÿä¸ä¸¥è°¨ï¼Œä»–æœ‰æ–‡æ¡£ï¼Œä½†**ä¸â€œæ¸…æ™°â€**ï¼Œè¿˜æ˜¯é¿å…ä¸äº†æ²Ÿé€šï¼Œæˆ–è€…æœ‰æ”¹åŠ¨ä»–ä¸æ›´æ–°ï¼Œæ¯•ç«Ÿåˆ¶å®šè§„çŸ©å¹¶ä¸¥æ ¼éµå®ˆå¯æ²¡ç›´æ¥å£å£ç›¸ä¼ æ¥çš„â€œèˆ’æœâ€ï¼Œå°±æ˜¯**å›¾æ–¹ä¾¿**ï¼Œä½†è¿™å°±**å¾ˆå±é™©**ï¼Œå¤§å®¶ä¸€æ—¦åŒæ­¥é”™ä¹±ï¼ŒåŠŸèƒ½å°±å†™é”™ï¼Œé‚£æµªè´¹çš„äººåŠ›ç‰©åŠ›è¿˜æœ‰ç©ºå£ç™½ç‰™ï¼Œæ²¡å¤„è¯´ç†å»æ‰€å¼•èµ·çš„å¿ƒæ€å´©äº†ï¼Œè¿™ç®€ç›´**æ— æ³•æ¥å—**ï¼Œä¸å…¶åœ¨å›°æ‰°ä¸­å¿å—ï¼Œä¸æ˜¯æƒ³ä¸ªåŠæ³•â€œ**å˜ä¸€å˜**â€ï¼Œsoï¼Œæˆ‘å°±æäº†è¿™ä¸ªã€‚


# é‚£ä¹ˆå¼€å§‹ä¸Šèœ

## è®¾è®¡æ€è·¯

é¦–å…ˆæˆ‘æœŸæœ›taèƒ½å¤Ÿåœ¨æˆ‘è¯·æ±‚çš„æ—¶å€™ï¼Œå¸®æˆ‘åŠä¸¤ä»¶äº‹ï¼š

1. **ç¬¦ä¸ç¬¦åˆåå°çš„è¦æ±‚**ï¼šåœ¨è¯·æ±‚çš„æ—¶å€™ï¼Œå¯¹å…¥å‚ï¼ˆå‘é€ç»™åå°æ•°æ®ï¼‰è¿›è¡Œç›¸åº”çš„æ ¡éªŒã€‚
2. **ç¬¦ä¸ç¬¦åˆå‰å°çš„è¦æ±‚**ï¼šåœ¨è¯·æ±‚å›æ•°æ®çš„æ—¶å€™ï¼Œå¯¹å‡ºå‚ï¼ˆåå°è¿”å›çš„æ•°æ®ï¼‰è¿›è¡Œç›¸åº”çš„æ ¡éªŒã€‚

*ç„¶åï¼Œåœ¨è¡¥ä¸Šä¸€ä¸ªç‰¹ç‚¹*

3. **å¯é…ç½®**

æ¥ä¸‹æ¥å¼€æ•´å§â˜ºã€‚

## é…ç½®æ–¹æ³•

### å…ˆè´´å‡ºé…ç½®æ•°æ®ï¼Œç„¶åæˆ‘ä»¬å†åˆ†æï¼š

```js
import BaseApiShape from './baseApiCheck'


let config = {
    fetchTestDataList: {
        reqParam: {
            type: {},//ä¸å†™é»˜è®¤æ˜¯å¯¹è±¡
            p1: {
                type: "string",//è¦æ±‚æ˜¯ä»€ä¹ˆç±»å‹ï¼Œä¼ å…¥ç±»å‹åï¼Œå¦è€…ç›´æ¥å–ä¼ å…¥å˜é‡çš„ç±»å‹
            },
            p2: {
                type: {},
            },
            p13: {
                type: "string",
            },
        },
        resParam: {
            p1: {
                type: [],
            },
            p2: {
                type: {},
            }
        }
    },
    fetchLightDetail: {
        resParam: {
            type: [],
            _item: {
                lightItems: {
                    type: [],
                    _item: {
                        exclude: {
                            type: "boolean",
                        }
                    },
                },
                aaaaa: {
                    type: {},
                }
            }
        }
    }
}

export default new BaseApiShape({ config })

```

## åˆ†æï¼š

ä¸Šé¢çš„ä¸¤ä¸ªæ ¡éªŒä¸ªä½“éå¸¸å…¸å‹ï¼Œå®Œæ•´çš„æŠŠæˆ‘æ‰€æœ‰çš„æ ¡éªŒåŠŸèƒ½éƒ½ä½“ç°å‡ºæ¥äº†ï¼š

* `fetchTestDataList`
* `fetchLightDetail`

### å¤§ä½“ç»“æ„æ˜¯è¿™æ ·çš„ï¼š

```js
    {
        reqParam: {
           ...
        },
        resParam: {
           ...
        }
    }
```

**çœ‹åçŒœæ„**ï¼Œ`reqParam`å’Œ`resParam`ï¼Œåˆ†åˆ«æ˜¯ä»£è¡¨çš„å…¥å‚ï¼ˆå‰=>åï¼‰å’Œå‡ºå‚ï¼ˆå=>å‰ï¼‰ã€‚

### ç„¶åæˆ‘ä»¬å†ç»§ç»­æ·±å…¥çœ‹ä¸€ä¸‹ï¼š

**å…ˆä»‹ç»ä¸€ä¸‹çº¦å®šçš„è§„çŸ©ï¼š**

`type`ï¼šå°±æ˜¯è¡¨ç¤ºè¦æ±‚çš„å‚æ•°ç±»å‹ï¼Œè‡³äºæ€ä¹ˆä¼ ï¼Œï¼ˆåŸºæœ¬ï¼‰éƒ½è¡Œï¼Œæ¯”å¦‚ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½ æ˜¯ä¼ â€œstringâ€ç›´æ¥å‘Šè¯‰æˆ‘ä»€ä¹ˆç±»å‹è¿˜æ˜¯éšä¾¿ç»™æˆ‘ä¸ªå­—ç¬¦ä¸²å˜é‡æˆ‘å†…éƒ¨å–ä¸€ä¸‹ç±»å‹éƒ½è¡Œï¼Œå°±æ˜¯å¾ˆéšæ„ã€‚

`_item`ï¼šè¡¨ç¤ºä¸€ä¸ªæ•°ç»„ä¸­å…ƒç´ ï¼Œåªä¼šåœ¨æ˜¯æ•°ç»„ç±»å‹ä¸‹å‡ºç°ã€‚

**æ¡ˆä¾‹ä¸€ï¼š**

```js
    {
        // åˆ†æç‚¹ï¼šA
        type: {},
        // åˆ†æç‚¹ï¼šB
        p1: {
            type: "string", // åˆ†æç‚¹ï¼šC
        },
        p2: {
            type: {},
        },
        p13: {
            type: "string",
        },
    }
```
*ABCè¯´æ˜ç™½taï¼š*
* A:`type`è¡¨ç¤ºçš„æ˜¯è¿™æ•´ä½“æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚
* B:`p1`è¡¨ç¤ºè¿™ä¸ªç»“æ„ä¸­è¦åå­—ä¸º`p1`çš„å±æ€§ã€‚
* C:`p1`é‡Œé¢çš„`type`,å°±è¡¨ç¤º`p1`åº”è¯¥æ˜¯ä»€ä¹ˆç±»å‹ã€‚

*ç„¶åå†è¯´ä¸€ä¸‹æ¡ˆä¾‹äºŒ*

**æ¡ˆä¾‹äºŒï¼š**
```js
    {
        // åˆ†æç‚¹ï¼šA
        type: [],
        // åˆ†æç‚¹ï¼šB
        _item: {
             // åˆ†æç‚¹ï¼šC
            lightItems: {
                type: [],
                _item: {
                    exclude: {
                        type: "boolean",
                    }
                },
            },
            aaaaa: {
                type: {},
            }
        }
    }
```

*ABCè¯´æ˜ç™½taï¼š*
* A:`type`è¡¨ç¤ºçš„æ˜¯è¿™æ•´ä½“æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œï¼ˆæ³¨æ„å¥¥ï¼Œè¿™æ˜¯æ•°ç»„å“¦ï¼ï¼‰ã€‚
* B:`_item`è¡¨ç¤ºæ•°ç»„ä¸­çš„å…ƒç´ ã€‚
* C:`lightItems`è¯´æ˜è¿™è¿˜æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¿™å°±æ„æˆäº†ä¸€ä¸ªåµŒå¥—æ•°ç»„ï¼Œè¶…çº§å¤æ‚ï¼Œæ²¡å…³ç³»ï¼Œæ”¯æŒï¼ï¼ˆè¿™å°±å·²ç»å¾ˆæ·±äº†ï¼Œè¿˜æ·±ï¼Ÿé‚£å°±åº”è¯¥å’Œåå°çš„å“¥ä»¬èŠèŠäº†ã€‚ï¼‰

# æˆ‘ä»¬å®æˆ˜ä¸€ä¸‹

## ä»¥`fetchLightDetail`ä¸ºä¾‹

**è¿”å›çš„å‚æ•°å¦‚æœæ˜¯è¿™æ ·çš„ï¼š**

```js
[{
    lightName: "test_lightName_0",
    comment: "test_comment_0",
    lightItems: [
        { 
            lightItemId: 1, 
            lightType: 0, 
            baseSelect: 1,
            exclude: 0 
        }
    ]
}]
```

**é‚£ä¹ˆæ ¡éªŒç»“æœå°±æ˜¯ï¼š**
![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/08d92a60a6e94bde81dfcfc45e18dcd2~tplv-k3u1fbpfcp-zoom-1.image)

*å·²ç»å¾ˆæš–å¿ƒçš„æŠŠé—®é¢˜è¯´å‡ºæ¥äº†ï¼Œå¤Ÿç”¨äº†ï¼Œä»¥åå†ä¼˜é›…å§ï¼Œåæ­£æƒ³æ³•åŸºæœ¬è½åœ°äº†ã€‚*

## è´´ä¸€ä¸‹æ²¡æ€ä¹ˆæ¶¦è‰²çš„åŸºç±»å†…éƒ¨å®ç°ï¼Œæ²¡æµ‹é€ï¼Œä¼°è®¡æœ‰bugï¼ˆåº”è¯¥æ˜¯è‚¯å®šçš„ï¼‰

```js
let typeArr = [
    "bigInt",
    "boolean",
    "string",
    "symbol",
    "undefined",
    "object",
    "number",
    "function",
    "array"
]
export default class BaseApiShape {
    constructor(props) {
        const { config } = props;
        this.config = config;
        this.checkReport = []
    }
    process(config) {
        for (let key in config) {
            this[key] = _.cloneDeep(config[key])
        }
    }

    checkReqParams({ apiName, params }) {
        if (apiName in this.config) {
            return this.check({
                required: this.config[apiName].reqParam,
                current: params
            })
        }
    }

    checkResParams({ apiName, params }) {
        if (apiName in this.config) {
            return this.check({
                required: this.config[apiName].resParam,
                current: params
            })
        }
    }
    checkArr({ required, current = [], logPrefix }) {
        current.forEach((item, index) => {
            this.checkObj({
                required: required,
                current: item,
                logPrefix: logPrefix + `[${index}]`
            })
        })
    }
    check({ required = {}, current }) {
        if (required.type === "array" || Array.isArray(required.type)) {
            if (Array.isArray(current)) {
                if (required._item) {
                    this.checkArr({
                        required: required._item,
                        current: current,
                        logPrefix: "æ•´ä½“"
                    })
                }
            } else {
                this.checkReport.push({ property: "æ•´ä½“", message: `è¦æ±‚æ•°ç»„!` })
            }
        } else {
            this.checkObj({ required, current })
        }
        return this.checkReport;
    }
    //å¦‚æœä¸Šæ¥æ˜¯æ•°ç»„ï¼Œå®é™…ä¸Šå…¶å®åˆ¤æ–­å°±æ˜¯è‡ªå·±çš„å†…éƒ¨çš„å…ƒç´ ï¼Œé‚£å°±æ˜¯åˆ¤æ–­å¤šä¸ªå¯¹è±¡äº†
    checkObj({ required = {}, current = {}, logPrefix }) {
        for (let key in required) {
            let checkOption = required[key];
            if (Object.keys(checkOption).length) {
                const { isRequired = true, type } = checkOption;
                if (type === "array" || Array.isArray(type)) {
                    if (checkOption._item) {
                        this.checkArr({
                            required: checkOption._item,
                            current: current[key],
                            logPrefix: ` ${logPrefix + "->" + key}`
                        })
                    }
                    continue;
                }
                //æ ¡éªŒ-æ˜¯å¦å­˜åœ¨
                if (isRequired && !(key in current)) {
                    this.checkReport.push({ property: key, message: `å‚æ•°ä¸­å¹¶æ²¡æœ‰æŒ‡å®šè¦æ±‚çš„å±æ€§ï¼š${key}` })
                }
                //æ ¡éªŒ-ç±»å‹
                if ((typeArr.indexOf(type) != -1) || typeof type in typeArr || Array.isArray(type)) {
                    let typeTemp;
                    if (typeArr.indexOf(type) != -1) {
                        typeTemp = type;
                    } else {
                        typeTemp = typeof type;
                    }
                    if (typeTemp !== typeof current[key]) {
                        this.checkReport.push({ property: key, message: `${logPrefix && ('æ•°ç»„' + logPrefix)}:å‚æ•°ä¸­æŒ‡å®šè¦æ±‚çš„å±æ€§ç±»å‹ä¸å¯¹ï¼Œyes-${typeTemp}ï¼šno-${typeof current[key]}` })
                    }
                }
            }
        }
    }
}
```

# ç»“è¯­

è¥¿ä¸ºä¸­ç”¨ï¼Œå¤ä¸ºä»Šç”¨ï¼Œâ€œéš¾â€çš„ï¼Œâ€œæŠ½è±¡â€çš„çŸ¥è¯†ï¼Œç­‰äº†è§£ä¹‹åå°±æ˜ç™½å…¶å®æ˜¯å¾ˆå¤šâ€œç®€å•â€ç»„æˆçš„(æˆ‘ä¸ç›¸ä¿¡æœ‰coderå¯¹æ­¤æ²¡æ„Ÿæ‚Ÿ)ï¼Œä½ æŠ€æœ¯å†å¼ºï¼Œä½ æ²¡æœ‰â€œå¿ƒâ€ï¼Œä½ é¡¶å¤šæ˜¯ä¸ªæœºå™¨ï¼Œä½ æŠ€æœ¯å†å¼±ï¼Œä½ æœ‰â€œå¿ƒâ€ï¼Œä½ ä¹Ÿæ˜¯ä¸ªäººï¼Œä¸è¿‡åˆ†è‡ªå¤§ï¼Œä¸å¦„è‡ªè²è–„ï¼Œæ…¢æ…¢å­¦å§ï¼Œå®šä¸ªæ–¹å‘å¾€é‚£åŠªåŠ›ï¼Œç®¡taæˆä¸æˆå‘¢ğŸ˜ï¼Œæ— æˆæœ‰ç»ˆã€‚

[é›†æˆäº†è¯¥åŠŸèƒ½çš„ğŸŒ°](https://github.com/moderateReact/moderate-react-template)