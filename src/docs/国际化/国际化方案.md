# å‰ç«¯å›½é™…åŒ–æ˜¯ä»€ä¹ˆ

ç®€å•è¯´å°±æ˜¯ç¿»è¯‘ä¸€ä¸‹ï¼Œåˆ‡æ¢ä¸­è‹±æ–‡ï¼Œä½†ç»ä¸æ˜¯æŠŠæ•´ä¸ªè¯­è¨€åŒ…æ”¾è¿›å»ï¼Œé‚£å¯æ²¡å¿…è¦ï¼Œåªæ˜¯æŒ‰éœ€å¤„ç†å³å¯ï¼Œé‚£ä¹ˆå¦‚ä½•åˆ¶å®šä¸€ä¸ªä¼˜é›…çš„å›½é™…åŒ–æ–¹æ¡ˆï¼Œæ‰æ˜¯éœ€è¦é‡ç‚¹ç ”ç©¶çš„ã€‚

---

# è£…é…`react-intl`åº“

`react-intl`æ˜¯ä¸€ä¸ª Yahoo å…¬å¸å‡ºå“çš„ï¼Œæœ‰å…´è¶£å¯ä»¥è‡ªè¡Œäº†è§£ä¸€ä¸‹ã€‚

## å®‰è£…ï¼š

```shell
    yarn add react-intl
```

## ä½¿ç”¨ï¼š

```js
    ...
    import { IntlProvider } from "react-intl";
    ...
    class Root extends Component {
    render() {
        const {
        global: { locale },//å¯æšä¸¾çš„å€¼ä¸º"zh"å’Œ"en"
        } = this.props;
        return (
        <IntlProvider locale={locale} messages={language.getData()[locale]}>
            <App />
        </IntlProvider>
        );
    }
}
```

**åˆ†æï¼š**

1. é¦–å…ˆä½¿ç”¨çš„æ˜¯`IntlProvider`åŒ…è£¹ä¸€ä¸‹ã€‚
2. ç„¶åä¼ å…¥ä¸¤ä¸ªå‚æ•°:
   - `locale`: **å½“å‰è¯­è¨€ç¯å¢ƒ** ã€‚
   - `messages`:**æŒ‰éœ€é…ç½®çš„è¯­è¨€åŒ…**ï¼ˆä¸‹é¢é‡ç‚¹åˆ†æï¼‰ã€‚

_è‡³æ­¤åŸºæœ¬è£…é…å¤Ÿç”¨äº†ï¼Œå…¶ä»–â€œé«˜ç©â€çš„é…ç½®æœ‰å…´è¶£çš„å¯ä»¥ç»§ç»­æ¢ç©¶ã€‚_

---

# é‡ç‚¹è¯´ä¸€ä¸‹ **é…ç½®è¯­è¨€åŒ…** çš„æ–¹å¼

## â€œä¼ ç»Ÿâ€çš„æ¨¡å¼ï¼š

### é…ç½®è¯­è¨€åŒ…ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3f47a463bc124b8e82b7956c6da50184~tplv-k3u1fbpfcp-zoom-1.image)

**å’±ä»¬ä»¥ login ä¸ºä¾‹ï¼š**

`en-US`:

```js
const login = {
  "login.title": "User Center",
  "login.username": "please enter username",
  "login.usernameEmpty": "username cannot be empty!",
  "login.maxLength": "username is no more than 100 characters",
};

export default login;
```

`zh-CN`:

```js
const login = {
  "login.title": "ç”¨æˆ·ä¸­å¿ƒ",
  "login.username": "è¯·è¾“å…¥ç”¨æˆ·å",
  "login.usernameEmpty": "ç”¨æˆ·åä¸èƒ½ä¸ºç©ºï¼",
  "login.maxLength": "ç”¨æˆ·åä¸å¾—å¤šäº100ä¸ªå­—ç¬¦",
};

export default login;
```
### å¼€å‘ä½¿ç”¨
```js
...
/* å¼•å…¥ */
import { injectIntl } from "react-intl";
...
/*  æ³¨å…¥ä¸“å±å›½é™…åŒ–æ•°æ® */
@injectIntl
class Login extends React.Component {
    constructor(props) {
        super(props);
        const {
            intl: { formatMessage },
        } = this.props;
        /*  ä½¿ç”¨ */
        message.warning(formatMessage({ id: "login.maxLength" }))
    }
    ...
}
```

**åˆ†æï¼š**

1. é¦–å…ˆåœ¨é…ç½®è¯­è¨€åŒ…ä¸Šï¼Œéœ€è¦åˆ†åˆ«åœ¨`en-US`å’Œ`zh-CN`ç›®å½•ä¸‹é…ç½®ä¸¤ä¸ªç»“æ„ç›¸åŒï¼Œå€¼ä¸åŒçš„æ–‡ä»¶ã€‚
2. åŸºäºä¹‹å‰çš„è£…é…ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡`react-intl`æä¾›çš„`injectIntl`é«˜é˜¶ç»„ä»¶å¯¹æ‰€åœ¨ç»„ä»¶è¿›è¡ŒåŒ…è£…ï¼Œä»è€Œå¯ä»¥ç›´æ¥é€šè¿‡ props è·å¾—å›½é™…åŒ–æ•°æ®`intl`ã€‚
3. ä»`intl`ä¸­è·å¾—`formatMessage`,ä¼ å…¥ç‰‡æ®µ`id`ï¼Œå°±èƒ½è·å¾—ç¿»è¯‘çš„å€¼ã€‚

**ä½†æœ‰å¼Šç«¯ï¼š**

1. é…ç½®ä¸Šè¦é…ç½®ä¸¤ç»„å¤§ä½“ä¸€æ ·å°±æ˜¯å€¼ä¸åŒçš„æ•°æ®ï¼Œä¸€æ˜¯é‡å¤äº†ï¼ŒäºŒæ˜¯è¿˜å¾—äººå·¥å¯¹ä»—ç€å†™ï¼Œè¿™å°±å¾ˆæ¶å¿ƒäº†ã€‚

2. æ‰€æœ‰é¡µé¢éƒ½èƒ½â€œç”¨â€ä¸€ä¸ªæ•´ä½“ğŸ¤”ï¸ï¼Ÿï¼Ÿï¼Ÿè¿™ä¸å¥½ç»´æŠ¤å•Šï¼Œæƒé™æ²¡æ§åˆ¶å¥½å•Šï¼Œé¡µé¢å¯¹ç¿»è¯‘ç‰‡æ®µçš„ä¾èµ–ä¼šè¶Šæ¥è¶Šæ··ä¹±ï¼Œæœ€å¥½è¿˜æ˜¯å€Ÿé‰´ mobx è¿™ç§ä»“åº“çš„æ€æƒ³ï¼Œä½ ä¾èµ–å•¥æˆ‘ç»™ä½ å•¥ï¼Œä¸ä¾èµ–å°±ä¸ç»™ä½ ã€‚

3. æ¯æ¬¡ä½¿ç”¨æˆ‘éƒ½éœ€è¦`formatMessage`ç¿»è¯‘ï¼Œæ–‡ä»¶ä¸å¤šç‰‡æ®µä¸å¤šè¿˜è¡Œï¼Œè¦æ˜¯éƒ½å¤šå‘¢ï¼Ÿé‚£å²‚ä¸æ˜¯è¦å†™å¾ˆå¤šè¡Œï¼Œæ¯æ¬¡ render éƒ½å»æ‰§è¡Œç¿»è¯‘å‡½æ•°ï¼Œæ — ğŸŒ°ï¼š

```js
    ...
    render() {
        const {
        intl: { formatMessage },
        } = this.props;
        const { codeImage } = this.state;
        const usernamePlaceholder = formatMessage({ id: "login.username" });
        const usernameEmpty = formatMessage({ id: "login.usernameEmpty" });
        const passwordPlaceholder = formatMessage({ id: "login.password" });
        const passwordEmpty = formatMessage({ id: "login.passwordEmpty" });
        const codePlaceholder = formatMessage({ id: "login.code" });
        const maxLength = formatMessage({ id: "login.maxLength" });
        const pwdMaxLength = formatMessage({ id: "header_pwdMaxLength" });
        const codeEmpty = formatMessage({ id: "login.codeEmpty" });
        return (
        <div className="loginpagewrap">
            ...
        </div>)
        }
    ...
```

è¿™æ˜æ˜¾ä¸åˆç†å•Šï¼Œå¾—æƒ³ä¸ªè¾™å•Šã€‚

## ä¼˜åŒ–çš„æ¨¡å¼ï¼š

é¦–å…ˆé’ˆå¯¹ä¼ ç»Ÿæ¨¡å¼å„ä¸ªç¯èŠ‚è¿›è¡Œä¼˜åŒ–ã€‚

### é¦–å…ˆä»é…ç½®æ–¹å¼å…¥æ‰‹

```js
import BaseIntl from "./baseIntl";

let config = {
  light_searchSelect: {
    en: "searchSelect",
    zh: "è”æƒ³select",
  },
  light_baseSelect: {
    en: "baseSelect",
    zh: "åŸºæœ¬select",
  },
  light_computeNum: {
    en: "computeNum",
    zh: "è®¡ç®—å€¼",
  },
};

export default new BaseIntl({ config });
```

ä¸€ä¸ªæ–‡ä»¶è§£å†³ï¼Œè¿™å¤šå¥½ï¼Œå¹¶ä¸”é€šè¿‡`baseIntl`è¿›è¡Œæ‰©å±•ï¼Œä¸»è¦ä¸ºå…¶è¡¥å……äº†å…±ç”¨çš„ç¿»è¯‘ç‰‡æ®µï¼Œè¿™æ ·å¤§å¤§çš„è§£å†³äº†é‡å¤ç¿»è¯‘ç‰‡æ®µçš„é—®é¢˜ã€‚

### ç„¶ååŸºäº`react-intl`å®šåˆ¶ä¸€ä¸ªå±äºæˆ‘ä»¬çš„é«˜é˜¶ç»„ä»¶`intlHoc`

åšè¿™ä¸ªé«˜é˜¶ç»„ä»¶å‰ï¼Œå¾—å…ˆæ˜ç¡®æˆ‘ä»¬ä¸æ˜¯ç ´å`react-intl`ï¼Œè€Œæ˜¯æ‰©å±• taã€‚

**ç›´æ¥ä¸Šä»£ç ï¼š**

```js
import React from "react";
import { inject, observer } from "mobx-react";
import { injectIntl } from "react-intl";
import language from "SRC/language";

function hoc(id) {
  return function (WrappedComponent) {
    @injectIntl
    @inject("global")
    class IntlHoc extends React.Component {
      constructor(props) {
        super(props);
        const {
          global: { locale },
        } = this.props;
        this.state = {
          formatedMessage: this.formatMessage(),
          localeFlag: locale,
        };
      }

      formatMessage() {
        const { intl } = this.props;
        const { formatMessage } = intl;
        let targetArr = language.getIntlById(id);
        let trmpArr = {};
        for (let key in targetArr) {
          trmpArr[key] = formatMessage({ id: key });
        }
        return trmpArr;
      }
      shouldComponentUpdate() {
        const {
          global: { locale },
        } = this.props;
        if (this.state.localeFlag !== locale) {
          this.setState({
            localeFlag: locale,
            formatedMessage: this.formatMessage(),
          });
        }
        return true;
      }
      render() {
        const { formatedMessage } = this.state;
        const props = Object.assign({}, this.props, {
          intlData: formatedMessage,
        });
        return <WrappedComponent {...props} />;
      }
    }
    return IntlHoc;
  };
}

export default hoc;
```

ç„¶åä»£æ›¿`injectIntl`è¿›è¡ŒåŒ…è£…,æ — ğŸŒ°ï¼š

```js
...
import injectInternational from "COMMON/hocs/intlHoc";
...
@injectInternational("light")
class TempEdit extends Component {
     const {
            intlData
        } = this.props;
    render(){
        return <div>{intlData.light_editting}</div>
    }
}
```

__åˆ†æï¼š__

1. é¦–å…ˆåœ¨é«˜é˜¶ç»„ä»¶åŒ…è£…çš„æ–¹å¼ä¸Šåˆ«æ— äºŒè‡´ã€‚
2. æ›¿ä»£äº†ä¹‹å‰ä½¿ç”¨`formatMessage`ç¿»è¯‘çš„æ–¹å¼ï¼Œå¹¶å°†å…¶åœ¨é«˜é˜¶ç»„ä»¶å†…éƒ¨ç»Ÿä¸€åšå¥½ä¹‹åï¼Œå†å°†æ•°æ®æ³¨å…¥åˆ°ç»„ä»¶propsä¸­ï¼Œé€šè¿‡intlDataè·å–ï¼Œç›´æ¥é€šè¿‡â€œ.â€çš„æ–¹å¼å°±èƒ½è·å¾—ç¿»è¯‘ï¼Œæ—¢ç®€åŒ–äº†æµç¨‹åˆé¿å…äº†å‡½æ•°çš„å¤šä½™æ‰§è¡Œã€‚
3. æœ€å…³é”®çš„æ˜¯å¯ä»¥ä¸ºé¡µé¢ä¼ å…¥æŒ‡å®šçš„å›½é™…åŒ–æ¨¡å—ï¼Œè¿™å¤ªèˆ’æœäº†ï¼Œåˆ†å¼€ç»´æŠ¤ï¼ŒçœŸçš„å¾ˆæ£’ã€‚

---

# æ•ˆæœå±•ç¤º
![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2ce7fb0ac0184b45af7f88e53e596d79~tplv-k3u1fbpfcp-zoom-1.image)

---

# ç»“è¯­
å›½é™…åŒ–æ˜¯ä¸€ä»¶å¦‚æœä½ ä¸åœ¨æ„taï¼Œtaä¼šè®©ä½ å¾ˆå¤´ç–¼ï¼Œå¾ˆç—›è‹¦çš„äº‹æƒ…ï¼Œåƒæ˜¯ä¸€ç§ä¹ æƒ¯ï¼Œè¿˜æ˜¯æ—©å…»æˆä¸ºå¥½ï¼Œç­‰æœ€åå†å»å¼„ï¼Œä½ ä¼šæ„Ÿå¹æ€ä¹ˆè¿™ä¹ˆå¤šä¸œè¥¿è¦ç¿»è¯‘,æ‰€ä»¥ä¸€å¥—æ•´åˆå¥½çš„å›½é™…åŒ–è§£å†³æ–¹æ¡ˆå°±å¾ˆæœ‰ç”¨ã€‚

[å®è¡Œè¯¥å›½é™…åŒ–æ–¹æ¡ˆçš„ğŸŒ°](https://github.com/moderateReact/moderate-react-template)